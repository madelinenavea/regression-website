<!DOCTYPE html>
<html>
	

<head>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

</head>

<body>

<!-- OUTER TABS -->
<!-- UPLOAD TESTING SECTION -->
<h1>Upload Testing</h1>
<form id="upload-form">
  <input type="file" id="file-input" name="uploadedFile" accept=".csv" />
  <button type="submit" id="load-btn">Load File</button>
</form>

<div id="upload-message"></div>
<div id="columns-container"></div>

<button id="verify-btn">Verify Data Types</button>

<div id="boolean-panel" style="margin-top: 20px; display: none;">
  <h4>Boolean Columns Conversion</h4>
  <div id="boolean-columns-container"></div>
  <button id="apply-boolean-btn">Apply Boolean Conversion</button>
</div>

<div id="verification-result"></div>

<div id="table-container"></div>







<h1>Plotting</h1>

<div>
	<label for="files">Chose a file</label>
	<select id="files" name="files"></select>

	<!-- Fetch command to get all of the file names to add to the selector -->
	<script>
		function populateFileDropdown() {
    		axios.get('/filenames').then(res => {
    	        let select = document.getElementById('files');
    	        select.innerHTML = ""; // clear old options

            	// Add placeholder
        	    let placeholder = document.createElement('option');
        	    placeholder.textContent = "Select a file";
        	    placeholder.disabled = true;
        	    placeholder.selected = true;
        	    select.appendChild(placeholder);

	            // Add files from response
	            res.data.files.forEach(fileName => {
	                let option = document.createElement('option');
	                option.value = fileName;
	                option.textContent = fileName;
   	            	select.appendChild(option);
            	});
        	}).catch(error => {
        	    console.error("Error fetching file list:", error);
			});
		}

		// Initial load
		populateFileDropdown();
	</script>
</div>
	
<div class="tabs" id="outer-tabs">
    <button class="outer-tab active" data-target="bar-panel">Bar</button>
    <button class="outer-tab" data-target="plot-panel">Plot</button>
	<buttonn class="outer-tab" data-target="table-panel">Table</buttonn>
</div>

<!-- OUTER TAB CONTENT 1: BAR PANEL -->
<div id="bar-panel" class="tab-panel active">

    <!-- INNER TABS -->
    <div class="tabs" id="inner-tabs-bar">
        <button class="inner-tab active" data-target="auto-bar">Auto 1 List</button>
        <button class="inner-tab" data-target="custom-bar">Custom Categorical</button>
    </div>

    <!-- AUTO BAR -->
    <div id="auto-bar" class="inner-panel active" style="width:600px;height:600px;">
        <label for="column-name">Column</label>
		<select id="column-name"></select>
	    <button id="auto-bar-plot-button">Plot</button>

    </div>

    <!-- CATEGORICAL BAR -->
    <div id="custom-bar" class="inner-panel" style="width:600px;height:600px;">
        <label for="x-axis-bar">X Axis</label>
        <select id="x-axis-bar"></select>

        <label for="y-axis-bar">Y Axis</label>
        <select id="y-axis-bar"></select>
	    <button id="custom-bar-plot-button">Plot</button>

    </div>

</div>

<!-- OUTER TAB CONTENT 2: PLOT PANEL -->
<div id="plot-panel" class="tab-panel">

	<!-- INNER TABS -->
    <div class="tabs" id="inner-tabs-plot">
        <button class="inner-tab active" data-target="reg-plot">Regular Plot</button>
        <button class="inner-tab" data-target="bell-plot">Bell Curve</button>
    </div>

	<div id="reg-plot" class="inner-panel active" style="width:600px;height:600px;">
    	<label for="x-axis-plot">X Axis</label>
    	<select id="x-axis-reg"  class="x-axis"></select>
		<label for="y-axis-plot">Y Axis</label>
		<select id="y-axis-reg"  class="y-axis"></select>
    	<button id="reg-plot-button">Plot</button>
	</div>

	<div id="bell-plot" class="inner-panel" style="width:600px;height:600px;">
		<label for="x-axis-bell">X Axis</label>
    	<select id="x-axis-bell" class="x-axis"></select>
    	<label for="y-axis-bell">Y Axis</label>
    	<select id="y-axis-bell" class="y-axis"></select>
    	<button id="bell-plot-button">Plot</button>
	</div>

</div>

<!-- OUTER TAB CONTENT 3: REGRESSIONS TABLE PANEL -->
 <div id="table-panel" class="tab-panel">
	<table>
		<tr>
			<td>Calculation Type</td>
			<td>Result</td>
		</tr>
		<tr>
			<td>Total</td>
			<td id="total"></td>
		</tr>
		<tr>
			<td>Expected Value</td>
			<td id="expected-value"></td>
		</tr>
		<tr>
			<td>Variance</td>
			<td id="variance"></td>
		</tr>
		<tr>
			<td>Standard Deviation</td>
			<td id="standerd-deviation"></td>
		</tr>
		<tr>
			<td>Min</td>
			<td id="min"></td>
		</tr>
		<tr>
			<td>Max</td>
			<td id="max"></td>
		</tr>
		<tr>
			<td>Variance</td>
			<td id="variance"></td>
		</tr>
	</table>
 </div>


<style>
	table, th, td {
		border: 1px solid black;
		border-collapse: collapse;
	}
    .tabs {
        display: flex;
        gap: 6px;
        margin-bottom: 10px;
    }
    .tabs button {
        padding: 8px 12px;
        cursor: pointer;
    }
    .active {
        background-color: #ccc;
    }
    .tab-panel,
    .inner-panel {
        display: none;
    }
    .tab-panel.active,
    .inner-panel.active {
        display: block;
    }
</style>

<script>
	const mean = (arr) => arr.reduce((a,b) => a+b, 0) / arr.length;
	const variance = (arr, mean) => arr.reduce((a,b) => a + Math.pow(b - mean, 2), 0) / arr.length;

	function covariance(x, y, meanX, meanY) {
		let accumulator = 0;
		for (let i = 0; i < x.length; i++) {
			accumulator += (x[i] - meanX) * (y[i] - meanY);
		}
		return accumulator / x.length;
	}

	function plotBestFitLine(x, y, divName, name) {
		let meanOfX = mean(x);
		let meanOfY = mean(y);
		let slope = covariance(x, y, meanOfX, meanOfY) / variance(x, meanOfX);
		let yInt = meanOfY - slope * meanOfX;

		let maxX = Math.max(...x);
		let minX = Math.min(...x);
		console.log(maxX, minX, x, y, meanOfX, meanOfY, slope, yInt);

		const bestFitLine = [{
			x: [minX, maxX],
			y: [slope*minX + yInt, slope*maxX + yInt],
			type: 'scatter',
			name: name
		}];
		Plotly.plot(divName, bestFitLine);
	}

	function syncSelection(axis, value) { 
		sharedSelection[axis] = value;

	    // Update ALL dropdowns of that axis
	    document.querySelectorAll(`.${axis}-axis`).forEach(sel => {
	        sel.value = value;
	    });
	}

	let sharedSelection = {
	    x: null,
	    y: null
	};

	document.querySelectorAll(".x-axis").forEach(select => {
    	select.addEventListener("change", (e) => {
        	sharedSelection.x = e.target.value;

        	document.querySelectorAll(".x-axis").forEach(s => {
            	s.value = e.target.value;
			});
    	});
	});

	document.querySelectorAll(".y-axis").forEach(select => {
	    select.addEventListener("change", (e) => {
	        sharedSelection.y = e.target.value;

	        document.querySelectorAll(".y-axis").forEach(s => {
	            s.value = e.target.value;
	        });
	    });
	});

	let x_dropdowns = document.querySelectorAll(".x-axis");
	let y_dropdowns = document.querySelectorAll(".y-axis");
	let csv_plot_button = document.getElementById("reg-plot-button");
	let data_file = "/data/Walmart_Sales.csv";
</script>

<script src="/tab_script.js"></script>
<script src="/plot_script.js"></script>
<script src="/bar_script.js"></script>
<script src="/bell_plot.js"></script>
<script src="/upload.js"></script>

</body>
</html>
